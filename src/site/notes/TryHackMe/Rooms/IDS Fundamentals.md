---
{"dg-publish":true,"permalink":"/try-hack-me/rooms/ids-fundamentals/","created":"2024-11-23T21:56:27.960-05:00","updated":"2025-03-09T16:38:29.682-04:00"}
---

# Task 2 - Types of IDS

- **Deployment Modes**
	- **Host Intrusion Detection System (HIDS)**
		- Installed individually on the hosts and are responsible for only detecting potential security threats associated with that particular host.
		- Provide detailed visibility of the host’s activities.
		- Resource-intensive and require management on each host.
	- **Network Intrusion Detection System (NIDS)**
		- Detects potentially malicious activities within the whole network, regardless of any specific hosts.
		- Monitor the network traffic of all the hosts involved to detect suspicious activities.
		- Provides a centralized view of all the detections inside the whole network.
- **Detection Modes**    
	- **Signature-Based IDS:**
		- Each attack has its unique pattern, which is known as a signature.
		- Preserved by the IDS in their databases so that if the same attack happens in the future, it gets detected by its signature and reported.
		- The stronger the signature database of the IDS is, the more efficiently it would detect known threats.
		- Unable to detect zero-day attacks.
		- Can only detect the attacks that happened previously, and its signatures (patterns) are saved inside the database.
	- **Anomaly-Based IDS:**
		- First learns the normal behavior (baseline) of the network or system and performs detections if there is any deviation from the normal behavior.
		- Can also detect zero-day attacks
		- May generate a lot of false positives because the nature of most legitimate programs matches the malicious ones.
		- Can also reduce the false positives generated by anomaly-based IDS by fine-tuning it (manually defining the normal behavior in the IDS).
	- **Hybrid IDS:**
		- Uses the detection technique of the signature-based IDS.
		- If it encounters a new threat, it can leverage the detection method of anomaly-based IDS. 

> [!Question]
> **Which type of IDS is deployed to detect threats throughout the network?** 

> [!Success] Answer
> Network Intrusion Detection System

> [!Question]
> **Which IDS leverages both signature-based and anomaly-based detection techniques?** 

> [!Success] Answer
> Hybrid IDS
# Task 3 - IDS Example: Snort
  
- Uses signature-based and anomaly-based detections
	- Defined in rules files of Snort
	- Can tune the default rules or create custom rules

| Mode                                    | Description                                                                                                                                                                                                                                                                                                                   | Use Case                                                                                                                                               |
| --------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------ |
| Packet sniffer mode                     | - Reads and displays network packets without performing any analysis on them.<br>- The packet sniffer mode of Snort does not directly relate to IDS capabilities, but it can be helpful in network monitoring and troubleshooting.<br>- Allows you to display the network traffic on the console or even output it in a file. | The network team observes some network performance issues. To diagnose the issue, they need detailed insights into the network traffic.                |
| Packet logging mode                     | - Performs detection on the network traffic in real-time and displays the detections as alerts on the console for the security administrators to take action.<br>- The packet logging mode of Snort allows you to log the network traffic as a PCAP file, includes all detections from it.                                    | The security team needs to initiate a forensic investigation of a network attack. They would need the traffic logs to perform the root cause analysis. |
| Network Intrusion Detection System mode | - Primary mode that monitors network traffic in real-time and applies its rule files to identify any match to the known attack patterns stored as signatures.<br>- If there is a match, it generates an alert.<br>- Most relevant use case                                                                                    | The security team must proactively monitor their network or systems to detect potential threats.                                                       |

> [!Question]
> **Which mode of Snort helps us to log the network traffic in a PCAP file?** 

> [!Success] Answer
> Packet Logging Mode

> [!Question]
> **What is the primary mode of Snort called?** 

> [!Success] Answer
> Network Intrusion Detection System Mode
       
# Task 4 - Snort Usage
  
- Need to provide network interface and range
	- Normal run only captures traffic
	- Promiscuous mode captures/detects intrusions
- /etc/snort
	- Built-in rule files, config file (snort.conf), etc.
	- Snort.conf
		- Specify which rule files to enable, network range to monitor, enable other settings
- **Rule format**
    - `Action protocol sourceIP sourcePort -> DestinationIP DestinationPort RuleMetadata Message SignatureId RuleRevision`

| Action              | Specifies which action to take when the rule triggers.                                                                                                                                                                 |
| ------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| Protocol            | Protocol that matches this rule.                                                                                                                                                                                       |
| Source IP           | IP from which the traffic is originating.                                                                                                                                                                              |
| Source port         | Port from which the traffic is originating.                                                                                                                                                                            |
| Destination IP      | IP to which the matching traffic comes; it generates the alert. In this case, we used "$HOME_NET".<br><br>This is a variable, and we defined its value as our whole network’s range in the Snort’s configuration file. |
| Destination port    | Port the traffic would reach.                                                                                                                                                                                          |
| Rule metadata       | Every rule has some metadata. That is defined at the end of the rule in parentheses.                                                                                                                                   |
| Message (msg)       | Message to be displayed when the subject rule triggers.                                                                                                                                                                |
| Signature ID (sid)  | Every rule has a unique identifier that differentiates it from the other rules. In this case, we set the sid to "10001".                                                                                               |
| Rule revision (rev) | Revision number of the rule. Every time the rule is modified, its revision number is incremented.                                                                                                                      |

![](/img/user/TryHackMe/THM_Images/d854fc3d760e6919b38bb04eebd08a44.png)
- **Rule creation**
	- Open any rule file in Snorts rules directory
	- Add to file with the rule
```
alert icmp any any -> 127.0.0.1 any (msg:"Loopback Ping Detected"; sid:10003; rev:1;)
```

- **Rule testing**
	- sudo snort -q -l /var/log/snort -i lo -A console -c /etc/snort/snort.conf
	- Relace "lo" with actual interface name
	- Can then do commands to test if it works,
		- ping 127.0.0.1
	![Exported image](/img/user/TryHackMe/THM_Images/91f52c6a01e23dfd99de55a126792ad4.png)

PCAP files

```
sudo snort -q -l /var/log/snort -r Task.pcap -A console -c /etc/snort/snort.conf  
```

> [!Question]
> **Where is the main directory of Snort that stores its file?** 

> [!Success] Answer
> /etc/snort

> [!Question]
> **Which field in the Snort rule indicates the revision number of the rule?** 

> [!Success] Answer
> rev

> [!Question]
> **Which protocol is defined in the sample rule created in the task?** 

> [!Success] Answer
> icmp

> [!Question]
> **What is the file name that contains custom rules for Snort?** 

> [!Success] Answer
> local.rules
            
# Task 5 - Practical Lab

- Scenario:
	- You are a third-party forensic investigator. A company contacts you to investigate a recent attack on their network.
	- They handed over a PCAP file named "Intro_to_IDS.pcap", which contained the network traffic captured during the attack.
	- Your task is to run Snort on this PCAP file and answer the questions given in this task

> [!Question]
> **What is the IP address of the machine that tried to connect to the subject machine using SSH?** 

Ran the command, 

```
sudo snort -q -l /var/log/snort -r Intro_to_IDS.pcap -A console -c /etc/snort/snort.conf
```

![Exported image](/img/user/TryHackMe/THM_Images/69e206d895c20f8291f47e07dada3819.png)  

> [!Success] Answer
> 10.11.90.211

> [!Question]
> **What other rule message besides the SSH message is detected in the PCAP file?** 

![Exported image](/img/user/TryHackMe/THM_Images/b4b1bc3bd4ba52e358b28f251d54254a.png)  

> [!Success] Answer
> Ping Detected

> [!Question]
> **What is the sid of the rule that detects SSH?** 

> [!Success] Answer
> 1000002